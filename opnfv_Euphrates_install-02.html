<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



















  
  
  
  

  
    
    
  

  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/uploads/favicon-48x48.ico?v=6.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon-32x32.ico?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon-16x16.ico?v=6.1.0">


  <link rel="mask-icon" href="/uploads/favicon-48x48.ico?v=6.1.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.1.0',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'SBFCV05R39',
      apiKey: '',
      indexName: 'my hexo search',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="OPNFV Euphrates on baremetal">
<meta name="keywords" content="Euphrates">
<meta property="og:type" content="article">
<meta property="og:title" content="OPNFV Euphrates install（二）">
<meta property="og:url" content="https://louielong.github.io/opnfv_Euphrates_install-02.html">
<meta property="og:site_name" content="Louie&#39;s Blog">
<meta property="og:description" content="OPNFV Euphrates on baremetal">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://i.imgur.com/QEuXwvy.png">
<meta property="og:image" content="https://i.imgur.com/CCTp99A.jpg">
<meta property="og:image" content="https://wiki.opnfv.org/download/attachments/10296292/Pharos-topo.jpg?api=v2">
<meta property="og:image" content="https://i.imgur.com/jBeEhzU.jpg">
<meta property="og:image" content="https://i.imgur.com/5U7FW5X.jpg">
<meta property="og:image" content="https://i.imgur.com/pzsiLmn.jpg">
<meta property="og:updated_time" content="2018-04-13T09:32:24.579Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OPNFV Euphrates install（二）">
<meta name="twitter:description" content="OPNFV Euphrates on baremetal">
<meta name="twitter:image" content="https://i.imgur.com/QEuXwvy.png">



  <link rel="alternate" href="/atom.xml" title="Louie's Blog" type="application/atom+xml" />




  <link rel="canonical" href="https://louielong.github.io/opnfv_Euphrates_install-02.html"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>OPNFV Euphrates install（二） | Louie's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Louie's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">O ever youthful, O ever powerful.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-commonweal">
    <a href="/404/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />公益 404</a>
</li>

      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  
    

    
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
    

  


  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://louielong.github.io/opnfv_Euphrates_install-02.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Louie Long">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/shadian.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Louie's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">OPNFV Euphrates install（二）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-08T14:32:24+08:00">2017-12-08</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OPNFV/" itemprop="url" rel="index"><span itemprop="name">OPNFV</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/opnfv_Euphrates_install-02.html" class="leancloud_visitors" data-flag-title="OPNFV Euphrates install（二）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度：</span>
               
                 <span class="leancloud-visitors-count"></span>
                 <span>℃</span>
             </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计：</span>
                
                <span title="字数统计">18k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长&asymp;</span>
                
                <span title="阅读时长">0:18</span>
              
            </div>
          

          
            <div class="out-img-topic">
             <img src=https://i.imgur.com/yNc6FFv.jpg class="img-topic">
            </div>
          

          
              <div class="post-description">OPNFV Euphrates on baremetal</div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h2><p>本文详细介绍使用OPNFV 的 Fuel部署工具部署Euphrates版本。OPNFV社区从E版本开始全面采用XCI跨社区集成[1]方式，能够最快的获取并集成上游社区项目的最新代码同时可以减少等待BUG修复的时间，2017年10月Euphrates版本首发时还是基于Openstak的Ocata版本，而Ocata是在2017年2月份发布，但是到2017年8月底最新的Pike版本也发布了，由于OPNFV的版本发布周期与Openstack版本的发布周期不一致，也就意味着OPNFV的新版本永远是基于Openstack的上一个版本，OPNFV社区的测试项目将会一直滞后于Openstack的版本，在OPNFV社区引入XCI后我们看到在17年的11月份OPNFV已经支持Pike版本的虚拟POD安装。</p>
<p><img src="https://i.imgur.com/QEuXwvy.png" alt="OPNFV XCI"></p>
<p>在Danube版本时Fuel还是可视化的界面安装对于新接触OPNFV的新手或多或少还能慢慢学习研究。但是E版本的Fuel完全使用脚本命令的方式，无疑是加大了新手的入门难度以及学习难度，在研究Fuel的安装过程中遇到了许多坑也确实也学到了许多东西。</p>
<h2 id="2-安装环境准备"><a href="#2-安装环境准备" class="headerlink" title="2 安装环境准备"></a>2 <span id="jump0">安装环境准备</span></h2><p>社区在Fuel的安装指导[2]里介绍了如何使用Fuel安装Euphrates，但是这里不得不吐槽一下写这个wiki的人肯定认为阅读文档的人跟他一样是大神，文档写的太简单了，即使是一个环境配置的PDF（pod describe file）如果没有一定了解也是无从下手。</p>
<p>官方推荐的jumphost系统版本为 Ubuntu Xenial或 CentOS 7，本文采用的ubuntu 16.04 64b server版本，若采用CentOS软件安装的命令及版本名会稍有不同请自行搜索解决。</p>
<p>Fuel安装代码仓库：<a href="https://git.opnfv.org/fuel" target="_blank" rel="noopener">https://git.opnfv.org/fuel</a></p>
<p><strong>Note</strong>：部署时一定要选用最新的<code>stable/euphrates</code>稳定分支代码，该分支会持续修改部分部署BUG。</p>
<h3 id="2-1-POD配置文件-PDF"><a href="#2-1-POD配置文件-PDF" class="headerlink" title="2.1 POD配置文件-PDF"></a>2.1 POD配置文件-PDF</h3><p>官方给的参考POD文件是Fuel仓库里的LF(Linux Foundation)的pod1在<code>fuel/mcp/config/labs/local</code>目录下，接下来笔者以自己部署的baremetal POD来讲解PDF的内容。PDF采用Yaml格式，包含两部分文件，一部分是IDF用来描述<del>部署工具节点也叫jumphost</del>（这个地方的理解错误导致我出现了文末的<a href="#jump1">部署问题2</a>）节点的网络描述，内容相对简单，<strong>需要注意</strong>的是网卡名应与<strong>节点</strong>的网卡名称一致，一般是enoX或enpXs0，如果使用了DPDK则需要正确填写busaddr信息；另一部分是描述整个OPNFV各节点的详细网络、硬件资源等配置信息内容相对多。不熟悉Yaml格式的可以先预习一下Yaml格式：<a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/07/yaml.html</a></p>
<p>本次安装的PDF文件下载链接为：<a href="https://wiki.opnfv.org/download/attachments/10296292/idf-pod1.yaml?api=v2" target="_blank" rel="noopener">idf-pod1.yaml</a>，<a href="https://wiki.opnfv.org/download/attachments/10296292/pod1.yaml?api=v2" target="_blank" rel="noopener">pod1.yaml</a></p>
<p><code>fuel/mcp/config/labs/bii/idf-pod1.yaml</code>的内容如下，网桥的配置与后续安装执行的命令相关，网桥名字可以任取但是需要与安装时的命令参数保持一致。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"># Copyright (c) 2017 BII-CFIEC, Mirantis Inc., Enea AB and others.</span></span><br><span class="line"><span class="comment"># All rights reserved. This program and the accompanying materials</span></span><br><span class="line"><span class="comment"># are made available under the terms of the Apache License, Version 2.0</span></span><br><span class="line"><span class="comment"># which accompanies this distribution, and is available at</span></span><br><span class="line"><span class="comment"># http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">### BII POD 1 installer descriptor file ###</span></span><br><span class="line"></span><br><span class="line"><span class="attr">idf:</span></span><br><span class="line"><span class="attr">  version:</span> <span class="number">0.1</span></span><br><span class="line"><span class="attr">  fuel:</span></span><br><span class="line"><span class="attr">    jumphost:</span></span><br><span class="line"><span class="attr">      bridges:</span></span><br><span class="line"><span class="attr">        admin:</span> <span class="string">'br-pxe'</span></span><br><span class="line"><span class="attr">        mgmt:</span> <span class="string">'br-ctl'</span></span><br><span class="line"><span class="attr">        private:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">        public:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">    network:</span></span><br><span class="line"><span class="attr">      node:</span></span><br><span class="line">        <span class="comment"># Ordered-list, index should be in sync with node index in PDF</span></span><br><span class="line"><span class="attr">        - interfaces:</span> <span class="meta">&amp;interfaces</span></span><br><span class="line">            <span class="comment"># Ordered-list, index should be in sync with interface index in PDF</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">'eno1'</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">'eno2'</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">'eno3'</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">'eno4'</span></span><br><span class="line"><span class="attr">          busaddr:</span> <span class="meta">&amp;busaddr</span></span><br><span class="line">            <span class="comment"># Bus-info reported by `ethtool -i ethX`</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">'0000:01:00.0'</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">'0000:01:00.1'</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">'0000:02:00.0'</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">'0000:02:00.1'</span></span><br><span class="line"><span class="attr">        - interfaces:</span> <span class="meta">*interfaces</span></span><br><span class="line"><span class="attr">          busaddr:</span> <span class="meta">*busaddr</span></span><br><span class="line"><span class="attr">        - interfaces:</span> <span class="meta">*interfaces</span></span><br><span class="line"><span class="attr">          busaddr:</span> <span class="meta">*busaddr</span></span><br><span class="line"><span class="attr">        - interfaces:</span> <span class="meta">*interfaces</span></span><br><span class="line"><span class="attr">          busaddr:</span> <span class="meta">*busaddr</span></span><br><span class="line"><span class="attr">        - interfaces:</span> <span class="meta">*interfaces</span></span><br><span class="line"><span class="attr">          busaddr:</span> <span class="meta">*busaddr</span></span><br></pre></td></tr></table></figure>
<p><code>fuel/mcp/config/labs/bii/pod1.yaml</code>的内容如下，<em>detail</em>部分的描述属于非必填内容，<em>net_config</em>中的内容为各节点的描述信息，非常重要。可以配合拓扑图一起查看，部分配置的可选参数参考官方的<a href="https://github.com/opnfv/pharos/blob/master/config/pdf/pod1.yaml" target="_blank" rel="noopener">示例文件</a>。</p>
<ul>
<li><p><em>oob</em>指的的服务器的电源管理IP地址，Fuel安装过程中使用了Maas服务需要通过该地址去对服务器进行裸机管理，包括重启、开关机管理的，Maas是<a href="https://docs.ubuntu.com/maas/2.1/en/" target="_blank" rel="noopener">ubuntu社区</a>开发的裸机管理工具支持IPMI、虚拟机管理等，有兴趣的可以研究一下。这里也提一点这是NFV架构中针对PIM（Physical Infrastructure Management）物理基础设施的管理与Openstack的VIM(Virtual Infrastructure Management)虚拟设施管理相对。本次安装的服务器使用的是IPMI的2.0版本，这里有一个坑①是注意查看服务器的IPMI LAN 是否启用，对于DELL服务器在<code>iDRAC config-&gt;networking-&gt;IPMI config</code>，如果未开启安装时将会出现mas01节点无法连接其他节点（Ps. 这个坑我爬了三天才发现）；</p>
</li>
<li><p><em>interface</em>参数指的的该段网络使用的是哪个网卡，与<strong>idf-pod1.yaml</strong>中的<code>interfaces</code>网卡顺序以及<code>busaddr</code>严格匹配，但是oob的interface不受此参数控制；</p>
</li>
<li><p><em>vlan</em>标记该网络是否有vlan tag，如果没有则用’native’标记；</p>
</li>
<li><p><em>remote_params</em>是前面提到的IPMI管理，填入相应的IP、用户名、密码、mac地址，实际安装中该项的mac地址并没有使用到，该项的另一个参数是AMT，是英特尔的远端管理方式；</p>
</li>
<li><p>网卡特征中支持的参数是sriov和dpdk，笔者使用的服务器较老因此没有这些特性就选择空着；</p>
<p>剩下的一些服务器类型相关的信息，依据实际的服务器参数填写即可。需要指明的是节点的角色并不是按照配置文件中的命名来的，是按照节点的顺序来分配的依次是kvm01~03，cmp01~02，同时目前的安装方式对于节点的IP都是在指定的CIDR内随机分配的参看脚本<a href="https://github.com/opnfv/pharos/blob/master/config/installers/fuel/pod_config.yml.j2" target="_blank" rel="noopener">pod_config.yml.j2</a>。</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">### This is a BII POD1 descriptor file ###</span></span><br><span class="line"></span><br><span class="line"><span class="attr">details:</span></span><br><span class="line">  <span class="string">pod</span> <span class="attr">owner:</span> <span class="string">ylong</span></span><br><span class="line"><span class="attr">  contact:</span> <span class="string">ylong@biigroup.cn,</span> <span class="string">zjtang@biigroup.cn</span></span><br><span class="line"><span class="attr">  lab:</span> <span class="string">BII</span> <span class="string">Pharos</span> <span class="string">LAB</span></span><br><span class="line"><span class="attr">  location:</span> <span class="string">BDA,</span> <span class="string">Beijing,</span> <span class="string">China</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">development</span></span><br><span class="line"><span class="attr">  link:</span> <span class="attr">https://wiki.opnfv.org/display/pharos/BII</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"><span class="attr">net_config:</span></span><br><span class="line"><span class="attr">  oob:</span>                     <span class="comment"># IPMI management network</span></span><br><span class="line"><span class="attr">    interface:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">    ip-range:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.201</span><span class="bullet">-192.168</span><span class="number">.20</span><span class="number">.205</span></span><br><span class="line"><span class="attr">    vlan:</span> <span class="string">native</span></span><br><span class="line"><span class="attr">  admin:</span></span><br><span class="line"><span class="attr">    interface:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">    vlan:</span> <span class="string">native</span></span><br><span class="line"><span class="attr">    network:</span> <span class="number">10.20</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">    mask:</span> <span class="number">24</span></span><br><span class="line"><span class="attr">  mgmt:</span></span><br><span class="line"><span class="attr">    interface:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">    vlan:</span> <span class="number">101</span></span><br><span class="line"><span class="attr">    network:</span> <span class="number">192.168</span><span class="number">.101</span><span class="number">.0</span></span><br><span class="line"><span class="attr">    mask:</span> <span class="number">24</span></span><br><span class="line"><span class="attr">  private:</span></span><br><span class="line"><span class="attr">    interface:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">    vlan:</span> <span class="number">102</span></span><br><span class="line"><span class="attr">    network:</span> <span class="number">192.168</span><span class="number">.102</span><span class="number">.0</span></span><br><span class="line"><span class="attr">    mask:</span> <span class="number">24</span></span><br><span class="line"><span class="comment">#  storage:</span></span><br><span class="line"><span class="comment">#    interface: 3</span></span><br><span class="line"><span class="comment">#    vlan: 103</span></span><br><span class="line"><span class="comment">#    network: 192.168.103.0</span></span><br><span class="line"><span class="comment">#    mask: 24</span></span><br><span class="line"><span class="attr">  public:</span></span><br><span class="line"><span class="attr">    interface:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">    vlan:</span> <span class="string">native</span></span><br><span class="line"><span class="attr">    network:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.0</span></span><br><span class="line"><span class="attr">    mask:</span> <span class="number">24</span></span><br><span class="line"><span class="attr">    gateway:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.1</span></span><br><span class="line"><span class="attr">    dns:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">114.114</span><span class="number">.114</span><span class="number">.114</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"><span class="attr">jumphost:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">fuel</span></span><br><span class="line"><span class="attr">  node:</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">baremetal</span>               <span class="comment"># can be virtual or baremetal</span></span><br><span class="line"><span class="attr">    vendor:</span> <span class="string">Dell</span> <span class="string">Inc.</span></span><br><span class="line"><span class="attr">    model:</span> <span class="string">powerEdge</span> <span class="number">720</span></span><br><span class="line"><span class="attr">    arch:</span> <span class="string">x86_64</span></span><br><span class="line"><span class="attr">    cpus:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">    cpu_cflags:</span> <span class="string">hasewell</span>          <span class="comment"># add values based on CFLAGS in GCC</span></span><br><span class="line"><span class="attr">    cores:</span> <span class="number">4</span>                      <span class="comment"># physical cores, not including hyper-threads</span></span><br><span class="line"><span class="attr">    memory:</span> <span class="number">16</span><span class="string">G</span></span><br><span class="line"><span class="attr">  disks:</span>                          <span class="comment"># disk list</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">'disk1'</span>               <span class="comment"># first disk</span></span><br><span class="line"><span class="attr">      disk_capacity:</span> <span class="number">1100</span><span class="string">G</span>        <span class="comment"># volume</span></span><br><span class="line"><span class="attr">      disk_type:</span> <span class="string">hdd</span>              <span class="comment"># several disk types possible</span></span><br><span class="line"><span class="attr">      disk_interface:</span> <span class="string">sas</span>         <span class="comment"># several interface types possible</span></span><br><span class="line"><span class="attr">      disk_rotation:</span> <span class="number">15000</span>        <span class="comment"># define rotation speed of disk</span></span><br><span class="line"><span class="attr">  os:</span> <span class="string">ubuntu-16.04</span>                <span class="comment">#operation system installed</span></span><br><span class="line"><span class="attr">  remote_params:</span> <span class="meta">&amp;remote_params</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">ipmi</span></span><br><span class="line"><span class="attr">    versions:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">2.0</span></span><br><span class="line"><span class="attr">    user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    pass:</span> <span class="string">*****</span></span><br><span class="line"><span class="attr">  remote_management:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*remote_params</span></span><br><span class="line"><span class="attr">    address:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.200</span></span><br><span class="line"><span class="attr">    mac_address:</span> <span class="string">"44:A8:42:1A:68:78"</span></span><br><span class="line"><span class="attr">  interfaces:</span>                               <span class="comment"># physical interface list</span></span><br><span class="line"><span class="attr">    - mac_address:</span> <span class="string">"44:a8:42:15:10:03"</span></span><br><span class="line"><span class="attr">      speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">      features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">    - mac_address:</span> <span class="string">"44:a8:42:15:10:04"</span></span><br><span class="line"><span class="attr">      speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">      features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">    - mac_address:</span> <span class="string">"44:a8:42:15:10:05"</span></span><br><span class="line"><span class="attr">      speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">      features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">    - mac_address:</span> <span class="string">"44:a8:42:15:10:06"</span></span><br><span class="line"><span class="attr">      speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">      features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">  fixed_ips:</span></span><br><span class="line"><span class="attr">    admin:</span> <span class="number">10.10</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line"><span class="attr">    mgmt:</span> <span class="number">192.168</span><span class="number">.101</span><span class="number">.2</span></span><br><span class="line"><span class="attr">    public:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.235</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">controller1</span></span><br><span class="line"><span class="attr">    node:</span> <span class="meta">&amp;nodeparas</span></span><br><span class="line"><span class="attr">      type:</span> <span class="string">baremetal</span></span><br><span class="line"><span class="attr">      vendor:</span> <span class="string">Dell</span> <span class="string">Inc.</span></span><br><span class="line"><span class="attr">      model:</span> <span class="string">powerEdge</span> <span class="number">720</span></span><br><span class="line"><span class="attr">      arch:</span> <span class="string">x86_64</span></span><br><span class="line"><span class="attr">      cpus:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">      cpu_cflags:</span> <span class="string">hasewell</span>        <span class="comment"># add values based on CFLAGS in GCC</span></span><br><span class="line"><span class="attr">      cores:</span> <span class="number">4</span>                    <span class="comment"># physical cores, not including hyper-threads</span></span><br><span class="line"><span class="attr">      memory:</span> <span class="number">32</span><span class="string">G</span></span><br><span class="line"><span class="attr">    disks:</span> <span class="meta">&amp;disks_A</span>               <span class="comment"># disk list</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">'disk1'</span>             <span class="comment"># first disk</span></span><br><span class="line"><span class="attr">        disk_capacity:</span> <span class="number">128</span><span class="string">G</span>       <span class="comment"># volume</span></span><br><span class="line"><span class="attr">        disk_type:</span> <span class="string">ssd</span>            <span class="comment"># several disk types possible</span></span><br><span class="line"><span class="attr">        disk_interface:</span> <span class="string">sas</span>       <span class="comment"># several interface types possible</span></span><br><span class="line"><span class="attr">        disk_rotation:</span> <span class="number">15000</span>      <span class="comment"># define rotation speed of disk</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">'disk2'</span>             <span class="comment"># second disk</span></span><br><span class="line"><span class="attr">        disk_capacity:</span> <span class="number">2400</span><span class="string">G</span></span><br><span class="line"><span class="attr">        disk_type:</span> <span class="string">hdd</span></span><br><span class="line"><span class="attr">        disk_interface:</span> <span class="string">sas</span></span><br><span class="line"><span class="attr">        disk_rotation:</span> <span class="number">15000</span></span><br><span class="line"><span class="attr">    remote_management:</span></span><br><span class="line">      <span class="string">&lt;&lt;:</span> <span class="meta">*remote_params</span></span><br><span class="line"><span class="attr">      address:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.203</span></span><br><span class="line"><span class="attr">      mac_address:</span> <span class="string">"44:A8:42:1A:49:A5"</span></span><br><span class="line"><span class="attr">    interfaces:</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:cd:0d"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:cd:0e"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        feature:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:cd:0f"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        feature:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:cd:10"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        feature:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">    fixed_ips:</span></span><br><span class="line"><span class="attr">      admin:</span> <span class="number">10.20</span><span class="number">.0</span><span class="number">.16</span></span><br><span class="line"><span class="attr">      mgmt:</span> <span class="number">192.168</span><span class="number">.101</span><span class="number">.16</span></span><br><span class="line"><span class="attr">      public:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.16</span></span><br><span class="line"><span class="comment">########################################</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">controller2</span></span><br><span class="line"><span class="attr">    node:</span> <span class="meta">*nodeparas</span></span><br><span class="line"><span class="attr">    disks:</span> <span class="meta">*disks_A</span></span><br><span class="line"><span class="attr">    remote_management:</span></span><br><span class="line">      <span class="string">&lt;&lt;:</span> <span class="meta">*remote_params</span></span><br><span class="line"><span class="attr">      address:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.204</span></span><br><span class="line"><span class="attr">      mac_address:</span> <span class="string">"44:A8:42:1A:76:2C"</span></span><br><span class="line"><span class="attr">    interfaces:</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:15:1b:e6"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:15:1b:e7"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        feature:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:15:1b:e8"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        feature:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:15:1b:e9"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        feature:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">    fixed_ips:</span></span><br><span class="line"><span class="attr">      admin:</span> <span class="number">10.20</span><span class="number">.0</span><span class="number">.17</span></span><br><span class="line"><span class="attr">      mgmt:</span> <span class="number">192.168</span><span class="number">.101</span><span class="number">.17</span></span><br><span class="line"><span class="attr">      public:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.17</span></span><br><span class="line"><span class="comment">########################################</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">controller3</span></span><br><span class="line"><span class="attr">    node:</span> <span class="meta">*nodeparas</span></span><br><span class="line"><span class="attr">    disks:</span> <span class="meta">*disks_A</span></span><br><span class="line"><span class="attr">    remote_management:</span></span><br><span class="line">      <span class="string">&lt;&lt;:</span> <span class="meta">*remote_params</span></span><br><span class="line"><span class="attr">      address:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.205</span></span><br><span class="line"><span class="attr">      mac_address:</span> <span class="string">"44:A8:42:13:D5:1B"</span></span><br><span class="line"><span class="attr">    interfaces:</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:fc:1a"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:fc:1b"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        feature:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:fc:1c"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        feature:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:fc:1d"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        feature:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">    fixed_ips:</span></span><br><span class="line"><span class="attr">      admin:</span> <span class="number">10.20</span><span class="number">.0</span><span class="number">.18</span></span><br><span class="line"><span class="attr">      mgmt:</span> <span class="number">192.168</span><span class="number">.101</span><span class="number">.18</span></span><br><span class="line"><span class="attr">      public:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.18</span></span><br><span class="line"><span class="comment">########################################</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">compute1</span></span><br><span class="line"><span class="attr">    node:</span> <span class="meta">*nodeparas</span></span><br><span class="line"><span class="attr">    disks:</span> <span class="meta">*disks_A</span></span><br><span class="line"><span class="attr">    remote_management:</span></span><br><span class="line">      <span class="string">&lt;&lt;:</span> <span class="meta">*remote_params</span></span><br><span class="line"><span class="attr">      address:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.201</span></span><br><span class="line"><span class="attr">      mac_address:</span> <span class="string">"44:A8:42:1A:70:BE"</span></span><br><span class="line"><span class="attr">    interfaces:</span>                           <span class="comment"># physical interface list</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:ee:64"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:ee:65"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:ee:66"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:ee:67"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">    fixed_ips:</span></span><br><span class="line"><span class="attr">      admin:</span> <span class="number">10.10</span><span class="number">.0</span><span class="number">.14</span></span><br><span class="line"><span class="attr">      mgmt:</span> <span class="number">192.168</span><span class="number">.101</span><span class="number">.14</span></span><br><span class="line"><span class="attr">      public:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.14</span></span><br><span class="line"><span class="comment">########################################</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">compute2</span></span><br><span class="line"><span class="attr">    node:</span> <span class="meta">*nodeparas</span></span><br><span class="line"><span class="attr">    disks:</span> <span class="meta">*disks_A</span></span><br><span class="line"><span class="attr">    remote_management:</span></span><br><span class="line">      <span class="string">&lt;&lt;:</span> <span class="meta">*remote_params</span></span><br><span class="line"><span class="attr">      address:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.202</span></span><br><span class="line"><span class="attr">      mac_address:</span> <span class="string">"44:A8:42:1A:76:26"</span></span><br><span class="line"><span class="attr">    interfaces:</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:cb:31"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:cb:32"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:cb:33"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">      - mac_address:</span> <span class="string">"44:a8:42:14:cb:34"</span></span><br><span class="line"><span class="attr">        speed:</span> <span class="number">1</span><span class="string">gb</span></span><br><span class="line"><span class="attr">        features:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">    fixed_ips:</span></span><br><span class="line"><span class="attr">      admin:</span> <span class="number">10.20</span><span class="number">.0</span><span class="number">.15</span></span><br><span class="line"><span class="attr">      mgmt:</span> <span class="number">192.168</span><span class="number">.101</span><span class="number">.15</span></span><br><span class="line"><span class="attr">      public:</span> <span class="number">192.168</span><span class="number">.20</span><span class="number">.15</span></span><br></pre></td></tr></table></figure>
<p><em>坑①</em>：如下图所示：</p>
<p><img src="https://i.imgur.com/CCTp99A.jpg" alt="IPMI设置"></p>
<p>需要开启IPMI的LAN，另外还有一点关于密钥的，我的某一台服务器的不是<code>0000000000000000000000000000000000000000</code>，出现过maas无法连接节点的情况。</p>
<p>本次安装的拓扑图如下</p>
<p><img src="https://wiki.opnfv.org/download/attachments/10296292/Pharos-topo.jpg?api=v2" alt="topo"></p>
<h3 id="2-2-安装过程"><a href="#2-2-安装过程" class="headerlink" title="2.2 安装过程"></a>2.2 安装过程</h3><h4 id="2-2-1-网桥配置"><a href="#2-2-1-网桥配置" class="headerlink" title="2.2.1 网桥配置"></a>2.2.1 网桥配置</h4><p>配置jumphost的网桥保证运行其上的虚拟机与其它物理节点的联通，必要的网桥是pxe和ctl，public的网桥可以不用设置，脚本会主动添加nat转换。可以直接在<code>/etc/network/interfaces</code>中配置网桥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line"></span><br><span class="line">source /etc/network/interfaces.d/*</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The loopback network interface</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet manual</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The primary network interface</span></span><br><span class="line">auto eth1</span><br><span class="line">iface eth1 inet static</span><br><span class="line">address 192.168.20.5</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">network 192.168.20.0</span><br><span class="line">broadcast 192.168.20.255</span><br><span class="line">gateway 192.168.20.1</span><br><span class="line"><span class="meta">#</span><span class="bash"> dns-* options are implemented by the resolvconf package, <span class="keyword">if</span> installed</span></span><br><span class="line">dns-nameservers 114.114.114.114</span><br><span class="line">iface eth1 inet6 auto</span><br><span class="line"></span><br><span class="line">auto eth2</span><br><span class="line">iface eth2 inet manual</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">auto eth3</span></span><br><span class="line"><span class="meta">#</span><span class="bash">iface eth3 inet manual</span></span><br><span class="line"></span><br><span class="line">auto br-pxe</span><br><span class="line">iface br-pxe inet static</span><br><span class="line">address 10.20.0.1</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">bridge_ports eth0</span><br><span class="line">bridge_fd 0</span><br><span class="line"></span><br><span class="line">auto br-ctl</span><br><span class="line">iface br-ctl inet manual</span><br><span class="line">bridge_ports eth2</span><br><span class="line">bridge_fd 0</span><br></pre></td></tr></table></figure>
<p>网桥拓扑如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bridge name	bridge id		 STP enabled	interfaces</span><br><span class="line">br-ctl		8000.000c2948cc74	no		    eth2</span><br><span class="line">br-pxe		8000.000c2948cc60	no		    eth0</span><br></pre></td></tr></table></figure>
<p><em>PS</em>：之前采用过在EXSI虚拟机之上安装ubuntu16.04作为jumphost然后进行部署，部署过程中出现过mas01的dhcp应答node节点无法收到的情况导致安装一直不成功，最后不得使用裸机安装ubuntu16.04然后在进行部署（这个坑爬了一个星期，因为一直怀疑是自己的网桥配置错误），这里并不确认是否在虚拟机上一定无法部署成功只是写出来留意一下。</p>
<h4 id="2-2-2-运行部署脚本"><a href="#2-2-2-运行部署脚本" class="headerlink" title="2.2.2 运行部署脚本"></a>2.2.2 运行部署脚本</h4><p>将准备好的PDF文件放置在<code>opnfv/fuel/mcp/config</code>下的目录中，安装脚本会自动查找相应PDF文件，可以使用<code>ci/deploy.sh -h</code>命令来查看个参数的含义，上一篇文章也讲解了各参数的含义。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ci/deploy.sh -D -b file:///home/opnfv/fuel/mcp/config/ \</span><br><span class="line">	-l bii -p pod1 -s os-odl-nofeature-ha -B br-pxe,br-ctl</span><br></pre></td></tr></table></figure>
<p>部署策略的配置在<code>mcp/config/scenario/baremetal</code>目录中查看，默认分配给安装时的虚拟机cfg01和mas01的资源是4核、6G内存，若jumphost的资源较足可以适当扩大安装虚拟机分配的资源。Fuel的安装过程中会调用<code>fuel/mcp/scripts</code>下的相关脚本完成具体的安装任务，其中<code>lisb.sh</code>负责相关的网络配置等，<code>globals.sh</code>是一个全局变量配置文件，由于之前使用Danube版本的fuel安装时习惯了将openstack各节点的管理IP分配到10.20.0.0/24段因此为了避免与Fuel安装过程中的虚拟机冲突这里修改了默认的mcpcontrol虚拟机网络段。</p>
<p>安装过程中jumphost的cfg01(10.0.0.2)是用来下发安装时的相关配置的以及同步文件，mas01(10.0.0.3)是用来进行裸机管理的。使用命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -i /var/lib/opnfv/mcp.rsa ubuntu@10.0.0.3</span><br></pre></td></tr></table></figure>
<p>可以查看安装过程的状态，尤其是mas01的裸机管理，如果相应的配置没有设置好需要在这里排错，在mas01的<code>/var/lib/maas</code>目录下（若无该目录说明Maas服务未安装，需要等待一段时间），当Maas服务安装后可以使用<code>tail -f /var/log/maas/maas.log</code>查看各节点的安装状态，同时可以登录Maas的web界面查看各节点的状态。登录方式有<strong>两种</strong>：</p>
<p>1) jumphost中做NAT转发</p>
<p>关于nat转发不熟悉的可以查看这篇<a href="http://xstarcd.github.io/wiki/Linux/iptables_forward_internetshare.html" target="_blank" rel="noopener">博客</a>，博客中关于ipatables讲解十分详细。本文中192.168.20.5为jumphost的public IP，既可以访问外网也可以与局域网其他主机访问，10.20.0.1/24为jumphost 部署OPNFV环境的PXE网桥地址，仅限OPNFV环境的各节点访问。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -d 192.168.20.5 -p tcp --dport 80 -j DNAT --to 10.20.0.3:80</span><br><span class="line">iptables -A FORWARD -d 10.20.0.3 -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -t nat -A POSTROUTING -d 10.20.0.3 -p tcp --dport 80 -j SNAT --to 10.20.0.1</span><br></pre></td></tr></table></figure>
<p>在本机上访问<a href="http://192.168.20.5:8000/MAAS" target="_blank" rel="noopener">http://192.168.20.5:8000/MAAS</a></p>
<p>账号/密码：opnfv/opnfv_secret,即可查看。</p>
<p>2) 终端开启隧道</p>
<p>该方式如上一篇虚拟安装中讲解到，添加一个本机的80端口到mas01的80端口映射即可。访问本机的<a href="http://localhost/MAAS/" target="_blank" rel="noopener">http://localhost/MAAS/</a></p>
<p><img src="https://i.imgur.com/jBeEhzU.jpg" alt="Maas端口映射"></p>
<p>MAAS的dashboard会显示安装过程以及各节点的信息。</p>
<p><img src="https://i.imgur.com/5U7FW5X.jpg" alt="安装过程"></p>
<h4 id="2-2-3-修改虚拟机登录密码"><a href="#2-2-3-修改虚拟机登录密码" class="headerlink" title="2.2.3 修改虚拟机登录密码"></a>2.2.3 修改虚拟机登录密码</h4><p>1）简单的修改密码</p>
<p>部署过程中生成的虚拟机只能使用ssh+key的方式登录，因此需要修改一下密码方便后续的登录，使用下面的命令修改密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -i /var/lib/opnfv/mcp.rsa ubuntu@10.0.0.3 "sudo passwd root&lt;&lt;EOF</span><br><span class="line">r00tme</span><br><span class="line">r00tme</span><br><span class="line">EOF"</span><br></pre></td></tr></table></figure>
<p>2）修改密码和运行ssh密码登录</p>
<p>登录脚本准备<code>cat node_init.sh</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> File Name: ubuntu_init_conf.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Author: louie.long</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Mail: ylong@biigroup.cn</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Created Time: Thu 26 Oct 2017 11:09:05 AM CST</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Description: 这个脚本用于修改新建ubuntu系统的配置，</span></span><br><span class="line"><span class="meta">#</span><span class="bash">              包括：root密码（r00tme），允许ssh密码登录</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh -e</span></span><br><span class="line"></span><br><span class="line">sudo su</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Begin of check file exist and backup file</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">check_file_and_backup() &#123;</span><br><span class="line">    if [ ! -f "$1" ]; then</span><br><span class="line">        echo "$1 is not exist"</span><br><span class="line">        return 0</span><br><span class="line">    else</span><br><span class="line">        cp $1 $1-backup`date +%y%m%d_%H%M`</span><br><span class="line">        return 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># End of check file exist and backup file</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Begin of modify ssh config</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">modify_ssh_conf() &#123;</span><br><span class="line">    check_file_and_backup /etc/ssh/sshd_config</span><br><span class="line">    ret=$?</span><br><span class="line">    if [ $ret -eq 1 ]; then</span><br><span class="line">        sed -i 's/^.*PermitRootLogin.*$/PermitRootLogin yes/g' \</span><br><span class="line">            /etc/ssh/sshd_config</span><br><span class="line">        sed -i 's/^.*PasswordAuthentication.*$/PasswordAuthentication yes/g' \</span><br><span class="line">            /etc/ssh/sshd_config</span><br><span class="line">        service ssh restart</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># End of modify ssh config</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Begin of change root passwd to 'r00tme'</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">change_root_passwd()</span><br><span class="line">&#123;</span><br><span class="line">passwd root&lt;&lt;EOF</span><br><span class="line">r00tme</span><br><span class="line">r00tme</span><br><span class="line">EOF</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># End of change root passwd to 'r00tme'</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Begin of main</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">set</span> -x</span></span><br><span class="line">modify_ssh_conf</span><br><span class="line">change_root_passwd</span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># End of main</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br></pre></td></tr></table></figure>
<p>然后运行以下命令后，即可直接使用密码进行ssh登录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -i /var/lib/opnfv/mcp.rsa ubuntu@10.0.0.2 &lt; node_init.sh</span><br></pre></td></tr></table></figure>
<p>各虚拟机的IP可以在<code>fuel/mcp/deploy/images/pod_config.yml</code>中查看或在任意虚拟机的<code>/etc/hosts</code>中查看，登陆http://<proxy vip="">:8090页面也可查看各节点及相关服务的信息，<code>Proxy vip</code>与openstack的dashboard访问IP一致。</proxy></p>
<h3 id="2-3-部署中出现的问题"><a href="#2-3-部署中出现的问题" class="headerlink" title="2.3 部署中出现的问题"></a>2.3 部署中出现的问题</h3><p>部署过程中如果发现不太正常的情况可以对比一下OPNFV官方<a href="https://build.opnfv.org/ci/view/fuel/job/fuel-deploy-baremetal-daily-euphrates/" target="_blank" rel="noopener">Jeklins</a>的构建历史日志，便于确认问题所在。</p>
<p><img src="https://i.imgur.com/pzsiLmn.jpg" alt=""></p>
<p>1)部署超时</p>
<p>如果部署过程中在maas.log中出现部署超时如下所示，可能是软件安装未完成或者其他安装操作耗时超过设置的15分钟</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dec 13 09:27:00 mas01 maas.node: [error] kvm01: Marking node failed: Node operation &apos;Deploying&apos; timed out after 15 minutes.</span><br></pre></td></tr></table></figure>
<p>可以修改<code>mcp/patches/0010-maas-region-allow-timeout-override.patch</code>文件第46行适当延长deploy时间，如果延长时间仍然有问题这需要依据maas.log再次排查错误了。</p>
<p><em>2018年1月20日更新</em>：官方已经将此处的部署时间做了适当延长，<code>git show f25c19f7a3f90</code>查看。</p>
<p>2)<span id="jump1">节点网卡名配置</span></p>
<p><em>2017年12月21日更新</em></p>
<p>部署过程中脚本提示如下信息，经过对比官方的构建历史日志，如下信息输出是正常的，但是等待时间太长，就可能出现问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cmp002.baremetal-mcp-ocata-odl-ha.local:</span><br><span class="line">    Minion did not return. [Not connected]</span><br><span class="line">.kvm01.baremetal-mcp-ocata-odl-ha.local:</span><br><span class="line">    Minion did not return. [Not connected]</span><br><span class="line">kvm03.baremetal-mcp-ocata-odl-ha.local:</span><br><span class="line">    Minion did not return. [Not connected]</span><br></pre></td></tr></table></figure>
<p>登录到相应节点（<del>需要注意的是节点的登录与mas01的登录一样是使用密钥登录的，不能通过密码直接登录，因此需要在节点安装系统时就尝试登录进去修改密码，否则一旦出现上述错误可能没法通过ssh登录只能在终端输入用户密码登录</del>，此时还可以通过在cfg01节点上用salt-stack的命令来查看各节点信息，如<code>salt -C &quot;ctl* or cmp*&quot; cmd.run &quot;ifconfig -a&quot;</code>）查看网卡信息，本次出现的问题是节点在自动配置网络后没有PXE/admin的IP，打开<code>/etc/network/interfaces</code>发现其配置的网卡名为<code>ethX</code>而节点的网卡名为<code>enoX</code>，因此需要修改部署PDF中idf-pod1.yaml中的网卡名称，</p>
<p>3）openstack的dashboard无法访问</p>
<p>部署完成后再访问dashboard时出现无法访问的情况，查找了一下发现是代理虚拟机prx不正常，尝试ssh登录prx，无法访问（原因是代理虚拟机内没有传入密钥）。登录到相应的控制节点上使用virsh list查看虚拟机名称，尝试通过<code>virsh reboot prx02.baremetal-mcp-ocata-odl-ha.local</code>后发现可以访问dashboard。至于prx的访问可以使用<code>virsh console prx02.baremetal-mcp-ocata-odl-ha.local</code>免密访问。</p>
<p><strong>安装完成就可以愉快的玩耍了，初次安装会有一些麻烦，一旦安装完成后续的重新部署就会简单许多。</strong></p>
<p><a href="#jump0">返回文首</a></p>
<p>参考文献：</p>
<p>1)<a href="http://docs.opnfv.org/en/latest/submodules/releng-xci/docs/xci-overview.html#xci-overview" target="_blank" rel="noopener">OPNFV XCI 介绍</a></p>
<p>2)<a href="http://docs.opnfv.org/en/stable-euphrates/submodules/fuel/docs/release/installation/installation.instruction.html#top-of-the-rack-tor-configuration-requirements" target="_blank" rel="noopener">Fuel install guide</a></p>

      
    </div>

    

    
    
        <div>
            
    <div blockquote class="blockquote-center" style="color: #32CD32;font-size:18px;">
    -------------本文结束<i class="fa fa-heartbeat"></i>感谢您的阅读-------------
    </div>


        </div>
    
    

    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/wechatpay.jpg" alt="Louie Long 赞助louie买书看"/>
        <p>赞助louie买书看</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

      
        <div>
            
<br/>
<div style="border: 1px solid black">
<div style="margin-left:10px">
<span style="font-weight:blod">版权声明</span>
<img src="/uploads/cc.png" >
<br/>
<p style="font-size: 10px;line-height: 30px"><a href="http://ylong.net.cn" style="color:#258FC6">Louie's Blog</a> by <a href="http://ylong.net.cn" style="color:#258FC6">louie long</a> is licensed under a <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" style="color:#258FC6">Creative Commons BY-NC-ND 4.0 International License</a>.<br/>
由<a href="http://ylong.net.cn" style="color:#258FC6">龙雨</a>创作并维护的<a href="ylong.net.cn" style="color:#258FC6">Louie's Blog</a>博客采用<a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" style="color:#258FC6">创作共用保留署名-非商业-禁止演绎4.0国际许可证</a>。<br/>
本文首发于<a href="http://ylong.net.cn" style="color:#258FC6">Louie's Blog</a> 博客（ <a href="http://ylong.net.cn" style="color:#258FC6">http://ylong.net.cn</a> ），版权所有，侵权必究。
<br/>
转载请注明作者和链接地址<a href="http://ylong.net.cn" style="color:#258FC6">http://ylong.net.cn</a>, 如对文章内容有疑问请联系邮箱（ <a style="color:#258FC6">longyu805@163.com</a> ）。</p>
</div>
</div>


        </div>
      

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/source/tags/OPNFV/" rel="tag"><i class="fa fa-tag"></i> OPNFV</a>
          
            <a href="/source/tags/Euphrates/" rel="tag"><i class="fa fa-tag"></i> Euphrates</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/opnfv_Euphrates_install-01.html" rel="next" title="OPNFV Euphrates 安装（一）">
                <i class="fa fa-chevron-left"></i> OPNFV Euphrates 安装（一）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/openstack-images-password.html" rel="prev" title="openstack中镜像的密码修改">
                openstack中镜像的密码修改 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/shadian.png"
                alt="Louie Long" />
            
              <p class="site-author-name" itemprop="name">Louie Long</p>
              <p class="site-description motion-element" itemprop="description">一只会说666的程序媛鼓励师</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/louielong" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:longyu805@163.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/_long__" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-前言"><span class="nav-number">1.</span> <span class="nav-text">1 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-安装环境准备"><span class="nav-number">2.</span> <span class="nav-text">2 安装环境准备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-POD配置文件-PDF"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 POD配置文件-PDF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-安装过程"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 安装过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-网桥配置"><span class="nav-number">2.2.1.</span> <span class="nav-text">2.2.1 网桥配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-运行部署脚本"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.2.2 运行部署脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-修改虚拟机登录密码"><span class="nav-number">2.2.3.</span> <span class="nav-text">2.2.3 修改虚拟机登录密码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-部署中出现的问题"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 部署中出现的问题</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate"> 
    <i class="fa fa-ravelry"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Louie</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">86k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点总阅读时长">1:26</span>
  

  
  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <span id="busuanzi_container_site_pv">
  | 本站总访问量<span style="color:#FA8072" id="busuanzi_value_site_pv"></span>次
  </span>
  <span id="busuanzi_container_site_uv">
  | 本站访客数<span style="color:#FA8072" id="busuanzi_value_site_uv"></span>人次
  </span>
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  



	





  





  










  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=6.1.0"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("M8d5yPXQ5l0kwFz1bO6cF7b3-gzGzoHsz", "QEarlHm5c8XcuF22TbFD3Bqn");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            
            counter.save(null, {
              success: function(counter) {
                
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.get('time'));
                
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text('Counter not initialized! See more at console err msg.');
              console.error('ATTENTION! LeanCloud counter has security bug, see here how to solve it: https://github.com/theme-next/hexo-leancloud-counter-security. \n But you also can use LeanCloud without security, by set \'security\' option to \'false\'.');
            
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  
  

  

  

  

  

</body>
</html>
