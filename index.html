<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/blog/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/blog/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/blog/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/blog/favicon.ico?v=5.0.2" />






<meta name="description" content="O ever youthful, O ever powerful.">
<meta property="og:type" content="website">
<meta property="og:title" content="Louie&#39;s Blog">
<meta property="og:url" content="https://ylong.net.cn/index.html">
<meta property="og:site_name" content="Louie&#39;s Blog">
<meta property="og:description" content="O ever youthful, O ever powerful.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Louie&#39;s Blog">
<meta name="twitter:description" content="O ever youthful, O ever powerful.">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://ylong.net.cn/"/>


  <title> Louie's Blog </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/blog/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Louie's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">O ever youthful, O ever powerful.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/blog/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2017/06/11/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-11T17:56:08+08:00" content="2017-06-11">
              2017-06-11
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/blog/2017/06/11/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/11/hello-world/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog/2017/06/09/OPNFV测试项目-yardstick/" itemprop="url">
                  OPNFV 测试项目 -- Yardstick
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-09T15:20:08+08:00" content="2017-06-09">
              2017-06-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/blog/categories/OPNFV/" itemprop="url" rel="index">
                    <span itemprop="name">OPNFV</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/blog/2017/06/09/OPNFV测试项目-yardstick/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/09/OPNFV测试项目-yardstick/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="OPNFV-测试项目-–-Yardstick"><a href="#OPNFV-测试项目-–-Yardstick" class="headerlink" title="OPNFV 测试项目 – Yardstick"></a>OPNFV 测试项目 – Yardstick</h1><p><del>[TOC]</del></p>
<h2 id="1-使用-Docker-安装-Yardstick"><a href="#1-使用-Docker-安装-Yardstick" class="headerlink" title="1.使用 Docker 安装 Yardstick"></a>1.使用 Docker 安装 Yardstick</h2><p><strong>官方推荐 Docker 运行 Yardstick 测试</strong></p>
<h3 id="1-1安装-Docker"><a href="#1-1安装-Docker" class="headerlink" title="1.1安装 Docker"></a>1.1安装 Docker</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget -qO- https://get.docker.com/ | sh</div></pre></td></tr></table></figure>
<p>拉取 Yardstick 最新版</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull opnfv/yardstick:latest</div></pre></td></tr></table></figure>
<p>查看下载的 Docker 镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker images</div></pre></td></tr></table></figure>
<h2 id="2-准备-Yardstick-测试所需要的磁盘和镜像"><a href="#2-准备-Yardstick-测试所需要的磁盘和镜像" class="headerlink" title="2.准备 Yardstick 测试所需要的磁盘和镜像"></a>2.准备 Yardstick 测试所需要的磁盘和镜像</h2><p><em>NOTE</em>:当需要使用 openstack 的接口时必须先导入环境变量</p>
<p>将下列配置将保存到 openrc 文本中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">export OS_PROJECT_DOMAIN_NAME=Default</div><div class="line">export OS_USER_DOMAIN_NAME=Default</div><div class="line">export OS_PROJECT_NAME=admin</div><div class="line">export OS_USERNAME=admin</div><div class="line">export OS_PASSWORD=admin</div><div class="line">export OS_AUTH_URL=http://192.168.20.11:5000     #yardstick API接口的IP</div><div class="line">export OS_IDENTITY_API_VERSION=3</div><div class="line">export OS_IMAGE_API_VERSION=2</div><div class="line">export EXTERNAL_NETWORK=admin_floating_net       #外网的网络名</div></pre></td></tr></table></figure>
<p>使用 <code>source openrc</code>导入环境变量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source openrc</div></pre></td></tr></table></figure>
<p>在 Yardstick 容器中，Yardstick 存储库位于 /home/opnfv/repos 目录中。Yardstick 提供了一个 CLI 来准备 OpenStack 环境变量并自动创建 Yardstick 风格和访客镜像：</p>
<h3 id="2-1手动创建-Yardstick-falvor-和-guest-images"><a href="#2-1手动创建-Yardstick-falvor-和-guest-images" class="headerlink" title="2.1手动创建 Yardstick falvor 和 guest images"></a>2.1手动创建 Yardstick falvor 和 guest images</h3><p>在执行 Yardstick 测试用例之前，请确保在 OpenStack 中提供了 Yardstick falvor 和 guest images。有关创建 Yardstick falvor 和 guest images 的详细步骤，如下。</p>
<p>使用如下命令创建一个名称为 yardstick-flavor ，编号为100，内存为512M，3G磁盘，1个cpu的主机配置。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nova flavor-create yardstick-flavor 100 512 3 1</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">100</td>
<td style="text-align:center">创建镜像的ID</td>
</tr>
<tr>
<td style="text-align:center">512</td>
<td style="text-align:center">内存大小</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">磁盘大小 (G)</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">CPU数量</td>
</tr>
</tbody>
</table>
<p><img src="http://i.imgur.com/EhW1nuk.jpg" alt=""></p>
<h3 id="2-2创建用于-Yardstick-测试的访客镜像"><a href="#2-2创建用于-Yardstick-测试的访客镜像" class="headerlink" title="2.2创建用于 Yardstick 测试的访客镜像"></a>2.2创建用于 Yardstick 测试的访客镜像</h3><p>首先安装额外的工具包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update &amp;&amp; sudo apt-get install -y qemu-utils kpartx</div></pre></td></tr></table></figure>
<p>使用 Git 拉取 Yardstick 源码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone https://gerrit.opnfv.org/gerrit/yardstick</div></pre></td></tr></table></figure>
<p>使用 Yardstick 工具生成镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd yardstick</div><div class="line">sudo ./tools/yardstick-img-modify tools/ubuntu-server-cloudimg-modify.sh</div></pre></td></tr></table></figure>
<p>生成的镜像也加入到 Openstack 环境中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">glance --os-image-api-version 1 image-create \</div><div class="line">--name yardstick-image --is-public true \</div><div class="line">--disk-format qcow2 --container-format bare \</div><div class="line">--file /tmp/workspace/yardstick/yardstick-image.img</div></pre></td></tr></table></figure>
<p>一些 Yardstick 的测试用例使用 Cirros 0.3.5 或者 Ubuntu 16.04 的镜像，也可以将这些镜像加入到 Openstack 环境中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">openstack image create \</div><div class="line">--disk-format qcow2 \</div><div class="line">--container-format bare \</div><div class="line">--file $cirros_image_file \</div><div class="line">cirros-0.3.5</div><div class="line"></div><div class="line">openstack image create \</div><div class="line">--disk-format qcow2 \</div><div class="line">--container-format bare \</div><div class="line">--file $ubuntu_image_file \</div><div class="line">Ubuntu-16.04</div></pre></td></tr></table></figure>
<h2 id="3-运行-Yardstick"><a href="#3-运行-Yardstick" class="headerlink" title="3.运行 Yardstick"></a>3.运行 Yardstick</h2><h3 id="3-1启动-Yardstick-镜像"><a href="#3-1启动-Yardstick-镜像" class="headerlink" title="3.1启动 Yardstick 镜像"></a>3.1启动 Yardstick 镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -itd --privileged -v /var/run/docker.sock:/var/run/docker.sock -p 8888:5000 -e INSTALLER_IP=192.168.20.5 -e INSTALLER_TYPE=fuel --name yardstick opnfv/yardstick:latest</div></pre></td></tr></table></figure>
<p><strong>参数说明</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">-itd</td>
<td style="text-align:center">-i：交互式，即使不附加STDIN也会打开。 -t：分配伪TTY。 -d：在分离模式下，在后台运行容器。</td>
</tr>
<tr>
<td style="text-align:center">–privileged</td>
<td style="text-align:center">在yardstick容器中创建yardstick-image</td>
</tr>
<tr>
<td style="text-align:center">-e INSTALLER_IP=192.168.20.5 <br> -e INSTALLER_TYPE=fuel</td>
<td style="text-align:center">INSTALLER_TYPE可选参数为Apex，Compass，Fuel和Joid。 如果使用其他安装程序（如devstack），则可以忽略这些参数。</td>
</tr>
<tr>
<td style="text-align:center">-p 8888:5000</td>
<td style="text-align:center">如果需要在yardstick外使用yardstick容器需要加入该参数，将yardstick容器内的5000端口映射到宿主机的8888端口，如果宿主机的8888端口被占用可以换一个端口</td>
</tr>
<tr>
<td style="text-align:center">-v /var/run/docker.sock:/var/run/docker.sock</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">–name yardstick</td>
<td style="text-align:center">创建的容器名称</td>
</tr>
</tbody>
</table>
<h3 id="3-2配置-Yardstick-容器环境"><a href="#3-2配置-Yardstick-容器环境" class="headerlink" title="3.2配置 Yardstick 容器环境"></a>3.2配置 Yardstick 容器环境</h3><p>首先需要先进入到 Yardstick 容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker exec -it yardstick /bin/bash</div></pre></td></tr></table></figure>
<p>随后开始配置环境</p>
<p>引入环境配置将一下内容保存到 openrc 文件中，然后使用 <code>source openrc</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">export OS_PROJECT_DOMAIN_NAME=Default</div><div class="line">export OS_USER_DOMAIN_NAME=Default</div><div class="line">export OS_PROJECT_NAME=admin</div><div class="line">export OS_USERNAME=admin</div><div class="line">export OS_PASSWORD=admin</div><div class="line">export OS_AUTH_URL=http://192.168.20.11:5000     #yardstick API接口的IP</div><div class="line">export OS_IDENTITY_API_VERSION=3</div><div class="line">export OS_IMAGE_API_VERSION=2</div><div class="line">export EXTERNAL_NETWORK=admin_floating_net       #外网的网络名</div></pre></td></tr></table></figure>
<h3 id="3-3运行一个简单的测试例"><a href="#3-3运行一个简单的测试例" class="headerlink" title="3.3运行一个简单的测试例"></a>3.3运行一个简单的测试例</h3><p>修改 ping.ymal文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd ~/repos/yardstick</div><div class="line">vim samples/ping.yaml</div></pre></td></tr></table></figure>
<p><img src="http://i.imgur.com/rvEEYJv.jpg" alt=""></p>
<p>主要关注下图中绿色框内容，<em>image</em> 为测试的镜像名称，<em>flavor</em> 为生成的虚拟机配置，<em>user</em> 为虚拟机系统的登录用户名(cirros 镜像默认的用户名和密码为”user:cirros  pass:cubswin:)”，ubuntu 镜像用户名默认为”ubuntu”)，测试用的vm实例创建后会使用创建时的密匙登录，因此也是不需要密码的，但是系统用户名必须一致。<em>network</em> 指生成的虚拟机所在的网段，即内网的网络。<br><img src="http://i.imgur.com/ataU1pE.jpg" alt="ping 配置文件"></p>
<p>配置完 <code>ping.ymal</code>文件后，使用命令启动测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yardstick -d task start samples/ping.yaml</div></pre></td></tr></table></figure>
<p>测试结果会输出在<code>/tmp/yardstick.out</code>中，为了方便的查看测试结果，使用 influxdb 数据库和 Grafana 工具。</p>
<h2 id="4-安装-InfluxDB-和-Grafana"><a href="#4-安装-InfluxDB-和-Grafana" class="headerlink" title="4.安装 InfluxDB 和 Grafana"></a>4.安装 InfluxDB 和 Grafana</h2><p>官方给出的 <code>yardstick env influxdb</code> 和 <code>yardstick env grafana</code> 使用版本较低，建议手动安装和启动这两项服务</p>
<p>完整的操作过程为:</p>
<h3 id="4-1配置-InfluxDB-环境"><a href="#4-1配置-InfluxDB-环境" class="headerlink" title="4.1配置 InfluxDB 环境"></a>4.1配置 InfluxDB 环境</h3><p>使用 docker 安装并使用最新的 influxdb 版本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull tutum/influxdb</div></pre></td></tr></table></figure>
<p>启动 influxdb 的 docker 环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker run -d --name influxdb -p 8083:8083 -p 8086:8086 --expose 8090 --expose 8099 tutum/influxdb</div><div class="line">docker exec -it influxdb bash  #进入 influxdb 的 docker 环境</div></pre></td></tr></table></figure>
<p>配置 influxdb 数据库，增加 yardstick 表，便于后续存储 yardstick 测试结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">influx</div><div class="line"><span class="meta">&gt;</span>CREATE USER root WITH PASSWORD 'root' WITH ALL PRIVILEGES</div><div class="line"><span class="meta">&gt;</span>CREATE DATABASE yardstick;</div><div class="line"><span class="meta">&gt;</span>use yardstick;</div><div class="line"><span class="meta">&gt;</span>show MEASUREMENTS;</div></pre></td></tr></table></figure>
<p>在 Yardstick 的docker容器中使用如下命令测试 influxdb 数据库是否可用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -i -X POST  http://192.168.20.14:8086/query --data-urlencode "q=CREATE DATABASE mydb"</div></pre></td></tr></table></figure>
<p><code>192.168.20.14</code>为 influxdb 运行所在的宿主机 IP 地址，上述命令的功能是使用 influxdb 的 http API 在数据库中创建一个数据库</p>
<p><strong>NOTE</strong>如果上述命令执行失败，则需要查看宿主机的 防火墙规则，使用<code>iptables -L -nv</code>查看 <code>Chain INPUT</code>规则，如果是 drop 则使用<code>iptables -P INPUT ACCEPT</code>将其改为accept</p>
<h3 id="4-2配置-Grafana-环境"><a href="#4-2配置-Grafana-环境" class="headerlink" title="4.2配置 Grafana 环境"></a>4.2配置 Grafana 环境</h3><p>拉取 Grafana 在 docker 上的最新版</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull grafana/grafana</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -d --name grafana -p 3000:3000 grafana/grafana</div></pre></td></tr></table></figure>
<p>之后就可以在 <a href="http://host_ip:3000" target="_blank" rel="external">http://host_ip:3000</a> (admin/admin) 查看</p>
<p>如下图所示为三个环境容器都已经启动，因8888端口冲突所以将 Yardstick 的宿主机端口改为45678<br><img src="http://i.imgur.com/OKtO9SO.jpg" alt=""></p>
<p>4.3配置 Yardstick 测试结果输出到 influxdb 数据库</p>
<p>进入到 Yardstick 容器的环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker exec -it yardstick bash</div></pre></td></tr></table></figure>
<p>拷贝并修改 Yardstick 的配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cp yardstick/etc/yardstick/yardstick.conf.sample /etc/yardstick/yardstick.conf</div><div class="line">vim /etc/yardstick/yardstick.conf</div></pre></td></tr></table></figure>
<p><img src="http://i.imgur.com/13WSHjN.jpg" alt=""></p>
<p>修改<em>dispatcher</em>为<em>influxdb</em>，同时修改<em>influxdb</em>的IP地址，数据库名已经账号密码皆为4.1节所创建的。</p>
<p>配置完成后运行<code>yardstick -d task start samples/ping.yaml</code></p>
<h3 id="4-4在-Grafana-的web页面查看"><a href="#4-4在-Grafana-的web页面查看" class="headerlink" title="4.4在 Grafana 的web页面查看"></a>4.4在 Grafana 的web页面查看</h3><p>在浏览器输入 <a href="http://192.168.20.14:3000" target="_blank" rel="external">http://192.168.20.14:3000</a> (admin/admin)(本例中的 Grafana 宿主机地址是 192.168.20.14)</p>
<p>点击左上角图标配置 data source，随后创建 dashboard 查看数据即可。</p>
<p><img src="http://i.imgur.com/teplLiT.jpg" alt=""></p>
<h2 id="5-删除-Yardstick-容器"><a href="#5-删除-Yardstick-容器" class="headerlink" title="5.删除 Yardstick 容器"></a>5.删除 Yardstick 容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker stop yardstick &amp;&amp; docker rm yardstick</div></pre></td></tr></table></figure>
<p>参考链接：</p>
<p>1)<a href="https://docs.opnfv.org/en/stable-danube/submodules/yardstick/docs/testing/user/userguide/index.html" target="_blank" rel="external">https://docs.opnfv.org/en/stable-danube/submodules/yardstick/docs/testing/user/userguide/index.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/blog/uploads/shadian.png"
               alt="Louie Long" />
          <p class="site-author-name" itemprop="name">Louie Long</p>
          <p class="site-description motion-element" itemprop="description">O ever youthful, O ever powerful.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/blog/archives">
              <span class="site-state-item-count">2</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/blog/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/blog/tags">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Louie-LongCode/Config_Linux" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/2210983905" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Louie Long</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/blog/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/blog/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/blog/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/blog/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/blog/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/blog/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.0.2"></script>



  
  

  

  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ylong"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/blog/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/blog/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
